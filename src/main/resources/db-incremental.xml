<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="02.07.2017 17:40" author="mposhatov">
        <createTable tableName="CLIENT">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_CLIENT_1"/>
            </column>
            <column name="NAME" type="java.sql.Types.VARCHAR(20)">
                <constraints unique="true" uniqueConstraintName="UC_CLIENT_1"/>
            </column>
            <column name="JSESSIONID" type="java.sql.Types.VARCHAR(50)">
                <constraints unique="true" uniqueConstraintName="UC_CLIENT_2"/>
            </column>
            <column name="PASSWORD" type="java.sql.Types.VARCHAR(20)"/>
            <column name="PHOTO" type="java.sql.Types.BLOB"/>
            <column name="LEVEL" type="java.sql.Types.BIGINT"/>
            <column name="EXPERIENCE" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="10.07.2017 13:00" author="mposhatov">
        <createTable tableName="ACTIVE_SESSION">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_CLIENT_SESSION_1"/>
            </column>
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT">
                <constraints unique="true" uniqueConstraintName="UC_ACTIVE_SESSION_1"/>
            </column>
            <column name="CLIENT_STATUS" type="java.sql.Types.TINYINT"/>
            <column name="CREATED_AT" type="java.sql.Types.TIMESTAMP"/>
            <column name="IP" type="java.sql.Types.VARCHAR(20)"/>
            <column name="USER_AGENT" type="java.sql.Types.VARCHAR(200)"/>
        </createTable>
    </changeSet>

    <changeSet id="10.07.2017 13:54" author="mposhatov">
        <createTable tableName="CLOSED_SESSION">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_CLIENT_SESSION_1"/>
            </column>
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT"/>
            <column name="CREATED_AT" type="java.sql.Types.TIMESTAMP"/>
            <column name="FINISHED_AT" type="java.sql.Types.TIMESTAMP"/>
            <column name="IP" type="java.sql.Types.VARCHAR(20)"/>
            <column name="USER_AGENT" type="java.sql.Types.VARCHAR(200)"/>
        </createTable>
    </changeSet>

    <changeSet id="02.07.2017 17:42" author="mposhatov">
        <createTable tableName="CLIENTS_ROLE">
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_ROLE_1"/>
            </column>
            <column name="ROLE" type="java.sql.Types.TINYINT">
                <constraints primaryKey="true" primaryKeyName="PK_ROLE_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="05.07.2017 17:53" author="mposhatov">
        <createTable tableName="NOT_FREE_QUESTS_OF_CLIENTS">
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_NOT_FREE_QUESTS_OF_CLIENTS_1"/>
            </column>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_NOT_FREE_QUESTS_OF_CLIENTS_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="05.07.2017 18:58" author="mposhatov">
        <createTable tableName="COMPLETED_QUESTS_OF_CLIENTS">
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_COMPLETED_QUESTS_OF_CLIENTS_1"/>
            </column>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_COMPLETED_QUESTS_OF_CLIENTS_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="03.07.2017 16:40" author="mposhatov">
        <createTable tableName="QUEST">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_QUEST_1"/>
            </column>
            <column name="NAME" type="java.sql.Types.VARCHAR(50)"/>
            <column name="DESCRIPTION" type="java.sql.Types.VARCHAR(1000)"/>
            <column name="DIFFICULTY" type="java.sql.Types.TINYINT"/>
            <column name="EXPERIENCE" type="java.sql.Types.BIGINT"/>
            <column name="APPROVED" type="java.sql.Types.BOOLEAN"/>
            <column name="FREE" type="java.sql.Types.BOOLEAN"/>
            <column name="COST_USD" type="java.sql.Types.FLOAT(2)"/>
            <column name="START_STEP_ID" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="08.07.2017 21:02" author="mposhatov">
        <createTable tableName="QUESTS_CATEGORY">
            <column name="QUEST_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_QUESTS_CATEGORY_1"/>
            </column>
            <column name="CATEGORY" type="java.sql.Types.TINYINT">
                <constraints primaryKey="true" primaryKeyName="PK_QUESTS_CATEGORY_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="03.07.2017 16:43" author="mposhatov">
        <createTable tableName="STEP">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_STEP_1"/>
            </column>
            <column name="DESCRIPTION" type="java.sql.Types.VARCHAR(4000)"/>
            <column name="BACKGROUND_ID" type="java.sql.Types.BIGINT"/>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="08.07.2017 14:33" author="mposhatov">
        <createTable tableName="BACKGROUND">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_BACKGROUND_1"/>
            </column>
            <column name="CONTENT" type="java.sql.Types.LONGBLOB"/>
            <column name="CONTENT_TYPE" type="java.sql.Types.VARCHAR(20)"/>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="03.07.2017 16:51" author="mposhatov">
        <createTable tableName="ANSWER">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_ANSWER_1"/>
            </column>
            <column name="DESCRIPTION" type="java.sql.Types.VARCHAR(300)"/>
            <column name="NEXT_STEP_ID" type="java.sql.Types.BIGINT"/>
            <column name="WINNING" type="java.sql.Types.BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet id="06.07.2017 22:28" author="mposhatov">
        <createTable tableName="ANSWERS_OF_STEPS">
            <column name="ANSWER_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_ANSWERS_OF_STEPS_1"/>
            </column>
            <column name="STEP_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_ANSWERS_OF_STEPS_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 16:46" author="mposhatov">
        <createTable tableName="SUBJECT">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_SUBJECT_1"/>
            </column>
            <column name="NAME" type="java.sql.Types.VARCHAR(20)"/>
            <column name="VALUE" type="java.sql.Types.VARCHAR(20)"/>
            <column name="DESCRIPTION" type="java.sql.Types.VARCHAR(100)"/>
            <column name="NUMBER" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 17:57" author="mposhatov">
        <createTable tableName="REQUIREMENT_EVENTS_OF_ANSWERS">
            <column name="EVENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_REQUIREMENT_EVENTS_OF_ANSWERS_1"/>
            </column>
            <column name="ANSWER_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_REQUIREMENT_EVENTS_OF_ANSWERS_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 17:58" author="mposhatov">
        <createTable tableName="REQUIREMENT_SUBJECTS_OF_ANSWERS">
            <column name="SUBJECT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_REQUIREMENT_SUBJECTS_OF_ANSWERS_1"/>
            </column>
            <column name="ANSWER_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_REQUIREMENT_SUBJECTS_OF_ANSWERS_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 18:13" author="mposhatov">
        <createTable tableName="GIVING_EVENTS_OF_ANSWERS">
            <column name="EVENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_GIVING_EVENTS_OF_ANSWERS_1"/>
            </column>
            <column name="ANSWER_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_GIVING_EVENTS_OF_ANSWERS_1"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 18:14" author="mposhatov">
        <createTable tableName="GIVING_SUBJECTS_OF_ANSWERS">
            <column name="SUBJECT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_GIVING_SUBJECTS_OF_ANSWERS_1"/>
            </column>
            <column name="ANSWER_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_GIVING_SUBJECTS_OF_ANSWERS_1"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="05.07.12:23 12:23" author="mposhatov">
        <createTable tableName="SUBJECTS_OF_ACTIVE_GAME">
            <column name="SUBJECT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_SUBJECTS_OF_ACTIVE_GAME_1"/>
            </column>
            <column name="ACTIVE_GAME_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_SUBJECTS_OF_ACTIVE_GAME_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="05.07.12:23 12:24" author="mposhatov">
        <createTable tableName="EVENTS_OF_ACTIVE_GAME">
            <column name="EVENT_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_EVENTS_OF_ACTIVE_GAME_1"/>
            </column>
            <column name="ACTIVE_GAME_ID" type="java.sql.Types.BIGINT">
                <constraints primaryKey="true" primaryKeyName="PK_EVENTS_OF_ACTIVE_GAME_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 17:03" author="mposhatov">
        <createTable tableName="EVENT">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_EVENT_1"/>
            </column>
            <column name="NAME" type="java.sql.Types.VARCHAR(20)"/>
            <column name="VALUE" type="java.sql.Types.VARCHAR(20)"/>
            <column name="DESCRIPTION" type="java.sql.Types.VARCHAR(100)"/>
            <column name="NUMBER" type="java.sql.Types.BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 17:17" author="mposhatov">
        <createTable tableName="ACTIVE_GAME">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_ACTIVE_GAME_1"/>
            </column>
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT">
                <constraints unique="true" uniqueConstraintName="UC_ACTIVE_GAME_1"/>
            </column>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT"/>
            <column name="STEP_ID" type="java.sql.Types.BIGINT"/>
            <column name="CREATED_AT" type="java.sql.Types.TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="04.07.2017 17:19" author="mposhatov">
        <createTable tableName="CLOSED_GAME">
            <column name="ID" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="PK_CLOSED_GAME_1"/>
            </column>
            <column name="CLIENT_ID" type="java.sql.Types.BIGINT"/>
            <column name="QUEST_ID" type="java.sql.Types.BIGINT"/>
            <column name="STARTED_AT" type="java.sql.Types.TIMESTAMP"/>
            <column name="FINISHED_AT" type="java.sql.Types.TIMESTAMP"/>
            <column name="GAME_COMPLETED" type="java.sql.Types.BOOLEAN"/>
        </createTable>
        
        <createIndex tableName="CLOSED_GAME" indexName="IX_CLOSED_GAME_1">
            <column name="CLIENT_ID" />
        </createIndex>

        <createIndex tableName="CLOSED_GAME" indexName="IX_CLOSED_GAME_2">
            <column name="QUEST_ID" />
        </createIndex>
    </changeSet>

    <changeSet id="11.07.2017 18:12" author="mposhatov" dbms="MYSQL">
        <sql>SET GLOBAL max_allowed_packet=268435456</sql>
    </changeSet>

    <changeSet id="02.07.2017 17:46" author="mposhatov">
        <insert tableName="CLIENT">
            <column name="NAME">mposhatov</column>
            <column name="PASSWORD">mposhatov</column>
            <column name="LEVEL">1</column>
            <column name="EXPERIENCE">0</column>
        </insert>

        <insert tableName="CLIENTS_ROLE">
            <column name="CLIENT_ID">1</column>
            <column name="ROLE">1</column>
        </insert>
    </changeSet>

    <changeSet id="07.07.2017 17:01" author="mposhatov">
        <insert tableName="CLIENT">
            <column name="NAME">eminchenko</column>
            <column name="PASSWORD">eminchenko</column>
            <column name="LEVEL">1</column>
            <column name="EXPERIENCE">0</column>
        </insert>

        <insert tableName="CLIENTS_ROLE">
            <column name="CLIENT_ID">2</column>
            <column name="ROLE">1</column>
        </insert>
    </changeSet>


</databaseChangeLog>